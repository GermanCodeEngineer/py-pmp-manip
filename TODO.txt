TODOs:
    - complete tests
    - add "Raises" to docstrings
    - complete deoptimization
